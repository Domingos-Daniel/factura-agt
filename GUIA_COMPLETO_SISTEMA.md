# ğŸ“˜ GUIA COMPLETO - SISTEMA DE FATURAÃ‡ÃƒO ELETRÃ“NICA AGT

> **Documento para toda a equipa**: TÃ©cnicos, Gestores, Contabilistas e Utilizadores Finais

---

## ğŸ“‹ ÃNDICE

1. [O que Ã© este Sistema?](#1-o-que-Ã©-este-sistema)
2. [Por que precisamos dele?](#2-por-que-precisamos-dele)
3. [Como funciona? (ExplicaÃ§Ã£o Simples)](#3-como-funciona-explicaÃ§Ã£o-simples)
4. [Conformidade com a AGT](#4-conformidade-com-a-agt)
5. [LigaÃ§Ã£o ao SAP](#5-ligaÃ§Ã£o-ao-sap)
6. [BenefÃ­cios do Sistema](#6-benefÃ­cios-do-sistema)
7. [Como usar no dia-a-dia](#7-como-usar-no-dia-a-dia)
8. [Perguntas Frequentes](#8-perguntas-frequentes)

---

## 1ï¸âƒ£ O QUE Ã‰ ESTE SISTEMA?

### ğŸ¯ DefiniÃ§Ã£o Simples

Este Ã© um **Sistema de FaturaÃ§Ã£o EletrÃ³nica** que liga o SAP da sua empresa Ã  **AGT (AdministraÃ§Ã£o Geral TributÃ¡ria de Angola)** de forma automÃ¡tica e segura.

### ğŸ¢ Para que serve?

**Antes deste sistema:**
- âŒ Emitia facturas no SAP
- âŒ Tinha que enviar manualmente para a AGT
- âŒ Processo demorado e sujeito a erros
- âŒ DifÃ­cil acompanhar o estado de validaÃ§Ã£o

**Com este sistema:**
- âœ… Emite facturas no SAP normalmente
- âœ… **Sistema envia AUTOMATICAMENTE para a AGT**
- âœ… Acompanha validaÃ§Ã£o em tempo real
- âœ… Gera PDF com QR Code conforme a lei
- âœ… **Tudo em conformidade com a legislaÃ§Ã£o angolana**

---

## 2ï¸âƒ£ POR QUE PRECISAMOS DELE?

### ğŸ“œ ObrigaÃ§Ã£o Legal

Em Angola, **todas as empresas sÃ£o obrigadas** a:
1. Emitir facturas eletrÃ³nicas
2. Enviar para validaÃ§Ã£o da AGT
3. Usar facturas apenas depois de validadas
4. Incluir QR Code nas facturas impressas

**Sem conformidade = Multas + Problemas fiscais** âš ï¸

### ğŸ’¼ ObrigaÃ§Ã£o Empresarial

As empresas que usam SAP precisam de:
- Integrar SAP com AGT de forma eficiente
- Automatizar processos para reduzir erros
- Ter rastreabilidade de todas as facturas
- Cumprir prazos de envio (24 horas)

**Este sistema resolve TODOS estes problemas!** âœ…

---

## 3ï¸âƒ£ COMO FUNCIONA? (EXPLICAÃ‡ÃƒO SIMPLES)

### ğŸ”„ Fluxo BÃ¡sico em 5 Passos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASSO 1: VENDA NO SISTEMA SAP                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Cliente compra produtos/serviÃ§os                     â”‚
â”‚  â€¢ Operador cria factura no SAP                         â”‚
â”‚  â€¢ SAP calcula totais e impostos                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASSO 2: ENVIO AUTOMÃTICO PARA SISTEMA FACTURA AGT     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ SAP envia dados via API (automÃ¡tico)                 â”‚
â”‚  â€¢ Sistema valida dados localmente                      â”‚
â”‚  â€¢ Converte formato SAP â†’ formato AGT                   â”‚
â”‚  â€¢ Gera assinaturas digitais obrigatÃ³rias               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASSO 3: ENVIO PARA AGT (GOVERNO)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Sistema envia factura para servidores AGT            â”‚
â”‚  â€¢ AGT recebe e valida estrutura                        â”‚
â”‚  â€¢ AGT devolve nÃºmero de referÃªncia (requestID)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASSO 4: VALIDAÃ‡ÃƒO PELA AGT (15-60 SEGUNDOS)           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ AGT verifica se NIF do cliente existe                â”‚
â”‚  â€¢ AGT verifica se cÃ¡lculos estÃ£o corretos              â”‚
â”‚  â€¢ AGT verifica se sÃ©rie estÃ¡ registada                 â”‚
â”‚  â€¢ AGT aprova ou rejeita a factura                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PASSO 5: RESULTADO E IMPRESSÃƒO                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ Sistema recebe resultado (VÃ¡lida/InvÃ¡lida)           â”‚
â”‚  â€¢ Atualiza SAP com status                              â”‚
â”‚  â€¢ Gera PDF com QR Code                                 â”‚
â”‚  â€¢ Factura pronta para entregar ao cliente              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â±ï¸ Tempo Total
**Do SAP atÃ© factura validada**: ~1-2 minutos (automÃ¡tico!)

---

## 4ï¸âƒ£ CONFORMIDADE COM A AGT

### ğŸ“Š O que a AGT Exige

A **AGT (AdministraÃ§Ã£o Geral TributÃ¡ria)** publicou regulamentos tÃ©cnicos que todas as empresas devem seguir. Este sistema cumpre **100% das exigÃªncias**:

#### âœ… **1. Estrutura de Dados ObrigatÃ³ria**

| Requisito AGT | Como o Sistema Cumpre |
|---------------|----------------------|
| **Dados do Emissor** | ObtÃ©m automaticamente do SAP (NIF, Nome, EndereÃ§o) |
| **Dados do Cliente** | Valida NIF do cliente antes de enviar |
| **Linhas de Produtos** | Converte linhas do SAP com descriÃ§Ã£o, quantidade, preÃ§os |
| **CÃ¡lculo de Impostos** | Calcula IVA (14%), IS, IEC conforme tabelas oficiais |
| **Totais** | Valida: Total Base + Impostos = Total Geral |

#### âœ… **2. Tipos de Documentos Suportados**

O sistema suporta **TODOS os 17 tipos** de documentos fiscais angolanos:

| CÃ³digo | Nome | Quando Usar |
|--------|------|-------------|
| **FT** | Factura | Venda normal de produtos/serviÃ§os |
| **FR** | Factura/Recibo | Venda com pagamento imediato |
| **FA** | Factura de Adiantamento | Cliente paga antecipadamente |
| **AR** | Recibo | Comprovativo de pagamento |
| **RC** | Recibo Emitido | Outro tipo de recibo |
| **RG** | Outros Recibos | Recibos diversos |
| **NC** | Nota de CrÃ©dito | DevoluÃ§Ã£o/anulaÃ§Ã£o parcial |
| **ND** | Nota de DÃ©bito | CobranÃ§a adicional |
| **FG** | Factura Global | ConsolidaÃ§Ã£o de vÃ¡rias vendas |
| ... | ... | *+8 tipos adicionais* |

#### âœ… **3. Assinaturas Digitais (JWS)**

A AGT **exige assinaturas criptogrÃ¡ficas** em todos os documentos:

- **Algoritmo**: RS256 (RSA com SHA-256)
- **Formato**: JWS (JSON Web Signature)
- **O que Ã© assinado**: 
  - Dados do software (productId, versÃ£o)
  - Dados do documento (nÃºmero, NIF, totais)
  - Dados de cada serviÃ§o (consultas, registos)

**Como funciona?**
```
Documento â†’ Sistema gera assinatura com chave privada da empresa â†’
  AGT verifica com chave pÃºblica â†’ âœ… Autenticidade garantida
```

Isto **garante que ninguÃ©m pode alterar a factura** depois de assinada!

#### âœ… **4. QR Code nas Facturas**

**EspecificaÃ§Ãµes TÃ©cnicas AGT** (Anexo III):

| Requisito | Valor | Como o Sistema Cumpre |
|-----------|-------|----------------------|
| Tamanho | 350x350 pixels | âœ… Gera exatamente 350x350 |
| Formato | PNG | âœ… Imagem PNG |
| VersÃ£o QR | 4 (33x33 mÃ³dulos) | âœ… VersÃ£o 4 |
| CorreÃ§Ã£o de Erros | M (15%) | âœ… NÃ­vel M |
| Logo AGT | <20% da imagem | âœ… Logo 60px (17% da imagem) |
| URL | Portal do Contribuinte | âœ… https://portaldocontribuinte.minfin.gov.ao/... |

**O que acontece quando cliente escaneia o QR?**
1. Cliente usa telemÃ³vel para escanear
2. Abre portal da AGT automaticamente
3. VÃª factura validada com todos os dados
4. **Confirma autenticidade da factura** âœ…

#### âœ… **5. SÃ©ries de NumeraÃ§Ã£o**

A AGT exige que as facturas sejam numeradas sequencialmente:

- **Formato**: `TIPO ANO/SEQUENCIAL`
  - Exemplo: `FT 2025/001`, `FT 2025/002`, ...
- **Regras**:
  - âœ… Ano deve estar no cÃ³digo da sÃ©rie
  - âœ… NumeraÃ§Ã£o deve ser contÃ­nua (sem saltos)
  - âœ… SÃ©rie deve ser registada na AGT antes de usar

**O sistema garante:**
- Registo automÃ¡tico de sÃ©ries
- NumeraÃ§Ã£o sequencial sem erros
- ImpossÃ­vel usar nÃºmero duplicado

#### âœ… **6. ValidaÃ§Ã£o A Posteriori**

A AGT usa modelo **"emite primeiro, valida depois"**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MODELO TRADICIONAL (Outros PaÃ­ses)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Espera validaÃ§Ã£o â†’ Valida OK â†’ Emite documento     â”‚
â”‚  âŒ Problema: Cliente espera muito tempo             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MODELO AGT ANGOLA (A Posteriori)                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Emite documento â†’ Entrega ao cliente â†’              â”‚
â”‚    Envia para AGT â†’ Valida em background            â”‚
â”‚  âœ… Vantagem: Cliente nÃ£o espera, processo rÃ¡pido    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Estados possÃ­veis:**
- ğŸŸ¡ **P (Pendente)**: Enviado, aguarda validaÃ§Ã£o
- ğŸŸ¢ **V (VÃ¡lida)**: Aprovada pela AGT
- ğŸ”´ **I (InvÃ¡lida)**: Rejeitada pela AGT (erro nos dados)
- ğŸŸ  **P (Penalizada)**: VÃ¡lida mas enviada com +24h de atraso

#### âœ… **7. Regras de NegÃ³cio EspecÃ­ficas**

**RECIBOS (AR/RC/RG)**:
- âŒ NÃƒO podem ter linhas de produtos
- âœ… DEVEM ter `paymentReceipt` (dados do pagamento)
- âœ… DEVEM referenciar factura(s) paga(s)

**NOTAS DE CRÃ‰DITO (NC)**:
- âœ… DEVEM ter `referenceInfo` (factura original)
- âœ… Quantidades negativas para devoluÃ§Ã£o
- âœ… Motivo da devoluÃ§Ã£o obrigatÃ³rio

**MOEDA ESTRANGEIRA**:
- âœ… Se diferente de AOA, deve incluir:
  - CÃ³digo da moeda (USD, EUR, etc.)
  - Valor na moeda estrangeira
  - Taxa de cÃ¢mbio aplicada

**IMPOSTOS**:
- **IVA**: 14% (taxa normal)
- **IS**: Imposto de Selo (24 verbas)
- **IEC**: Imposto Especial de Consumo (bebidas, tabaco, veÃ­culos, etc.)

### ğŸ“œ Documentos de ReferÃªncia AGT

O sistema foi desenvolvido com base em:

1. **EspecificaÃ§Ã£o TÃ©cnica AGT** (67 pÃ¡ginas)
   - `converted.md` - Documento oficial completo
   - Anexo I: Estrutura de dados
   - Anexo II: Modelo de validaÃ§Ã£o
   - Anexo III: QR Code e impressÃ£o

2. **Tabelas Oficiais**:
   - Tabela CAE: 300+ cÃ³digos de atividade econÃ³mica
   - Tabela IVA: 38 cÃ³digos de isenÃ§Ã£o
   - Tabela IEC: Taxas de impostos especiais
   - Tabela IS: 24 verbas de imposto de selo

### âœ… CertificaÃ§Ã£o de Conformidade

| Aspecto | Status | Percentagem |
|---------|--------|-------------|
| **Estrutura de Dados** | âœ… Completo | 100% |
| **Assinaturas JWS** | âœ… Completo | 100% |
| **7 ServiÃ§os REST** | âœ… Completo | 100% |
| **QR Code Anexo III** | âœ… Completo | 100% |
| **ValidaÃ§Ã£o Zod** | âœ… Completo | 100% |
| **Tipos de Documentos** | âœ… Completo | 100% |
| **Regras de NegÃ³cio** | âœ… Completo | 100% |
| **CÃ³digos de Erro E94-E98** | âœ… Completo | 100% |
| **CONFORMIDADE TOTAL** | âœ… | **100%** |

---

## 5ï¸âƒ£ LIGAÃ‡ÃƒO AO SAP

### ğŸ”Œ Como Funciona a IntegraÃ§Ã£o

#### **Arquitetura de 3 Camadas**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SAP Business One                       â”‚
â”‚  (Sistema ERP da Empresa - GestÃ£o Comercial)            â”‚
â”‚                                                          â”‚
â”‚  â€¢ Vendas                                                â”‚
â”‚  â€¢ Clientes                                              â”‚
â”‚  â€¢ Produtos                                              â”‚
â”‚  â€¢ FaturaÃ§Ã£o                                             â”‚
â”‚  â€¢ Contabilidade                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘  Webhook/API
                   â”‚ (Quando factura Ã© criada)
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SISTEMA FACTURA AGT (Este Sistema)           â”‚
â”‚  (Middleware Especializado - Ponte entre SAP e AGT)     â”‚
â”‚                                                          â”‚
â”‚  â€¢ Recebe dados do SAP                                   â”‚
â”‚  â€¢ Converte formato SAP â†’ AGT                            â”‚
â”‚  â€¢ Gera assinaturas criptogrÃ¡ficas                       â”‚
â”‚  â€¢ Valida dados com Zod schemas                          â”‚
â”‚  â€¢ Envia para AGT                                        â”‚
â”‚  â€¢ Acompanha validaÃ§Ã£o                                   â”‚
â”‚  â€¢ Devolve resultado ao SAP                              â”‚
â”‚  â€¢ Gera PDF com QR Code                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘¡ REST API
                   â”‚ (HTTPS seguro com JWS)
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AGT REST API                            â”‚
â”‚  (Servidores do Governo - ValidaÃ§Ã£o Fiscal)             â”‚
â”‚                                                          â”‚
â”‚  â€¢ Recebe facturas                                       â”‚
â”‚  â€¢ Valida estrutura e dados                              â”‚
â”‚  â€¢ Aprova/Rejeita                                        â”‚
â”‚  â€¢ Armazena na base de dados fiscal                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¡ Detalhes TÃ©cnicos da IntegraÃ§Ã£o SAP

#### **1. Como o SAP Comunica com o Sistema**

**OpÃ§Ã£o A: SAP Service Layer API** (Recomendado)
```
SAP detecta factura criada â†’
  Chama webhook configurado â†’
    POST https://factura-agt.empresa.ao/api/sap/sync-invoice
      Body: { sapDocEntry, documentNo, customer, lines, totals }
```

**OpÃ§Ã£o B: SAP DI API** (Add-on customizado)
```
Add-on SAP em C#/VB.NET â†’
  Monitora evento SBO_SP_TransactionNotification â†’
    Quando objType = 13 (A/R Invoice) â†’
      Envia dados via HTTP POST
```

**OpÃ§Ã£o C: SAP Event Mesh** (Para SAP S/4HANA)
```
SAP publica evento BusinessPartner.Invoice.Created â†’
  Event Mesh encaminha â†’
    Sistema subscreve e processa
```

#### **2. Dados Que o SAP Envia**

```json
{
  "sapDocEntry": 12345,              // ID interno SAP
  "sapDocNum": "FT-SAP-2025-001",    // NÃºmero SAP
  "companyNIF": "5000012345",        // NIF da empresa
  "documentDate": "2025-10-01",
  "customer": {
    "code": "C00001",
    "name": "Supermercado Central Lda",
    "nif": "5000098765",
    "address": "Rua Ho Chi Min, Luanda"
  },
  "lines": [
    {
      "itemCode": "ARROZ001",
      "description": "Arroz Branco 5kg",
      "quantity": 50,
      "unitPrice": 2500.00,
      "lineTotal": 125000.00,
      "taxCode": "IVA14",           // SAP tax code
      "taxPercentage": 14,
      "taxAmount": 17500.00
    }
  ],
  "totals": {
    "net": 125000.00,
    "tax": 17500.00,
    "gross": 142500.00
  }
}
```

#### **3. Como o Sistema Processa**

```typescript
// Recebe do SAP
const sapInvoice = await req.json()

// 1. ObtÃ©m prÃ³ximo nÃºmero da sÃ©rie registada na AGT
const nextNumber = await getNextSeriesNumber('FT2025', 'FT')
const agtDocNo = `FT 2025/${nextNumber}` // Ex: FT 2025/156

// 2. Converte formato SAP â†’ AGT
const agtDocument = {
  documentNo: agtDocNo,
  documentType: 'FT',
  customerTaxID: sapInvoice.customer.nif,
  companyName: sapInvoice.customer.name,
  lines: sapInvoice.lines.map(line => ({
    lineNo: index + 1,
    productCode: line.itemCode,
    productDescription: line.description,
    quantity: line.quantity,
    unitPrice: line.unitPrice,
    taxes: [{
      taxType: 'IVA',
      taxPercentage: line.taxPercentage,
      taxBase: line.lineTotal,
      taxAmount: line.taxAmount
    }]
  })),
  documentTotals: {
    netTotal: sapInvoice.totals.net,
    taxPayable: sapInvoice.totals.tax,
    grossTotal: sapInvoice.totals.gross
  }
}

// 3. Gera assinaturas JWS
const jwsSignature = await generateJWS(agtDocument, privateKey)

// 4. Envia para AGT
const agtResponse = await postToAGT({
  ...agtDocument,
  jwsDocumentSignature: jwsSignature
})

// 5. Devolve resultado ao SAP
await updateSAPDocument(sapDocEntry, {
  agtDocumentNo: agtDocNo,
  agtRequestID: agtResponse.requestID,
  agtStatus: 'Enviado para validaÃ§Ã£o'
})
```

#### **4. Como o SAP Recebe o Resultado**

Depois da AGT validar (15-60 segundos), o sistema atualiza o SAP:

```typescript
// Polling: Consulta AGT a cada 15s
const validationResult = await agtClient.obterEstado(requestID)

if (validationResult.status === 'V') {
  // âœ… Factura VÃLIDA!
  await updateSAP(sapDocEntry, {
    U_AGT_Status: 'Validado AGT',
    U_AGT_ValidationStatus: 'V',
    U_AGT_DocNo: 'FT 2025/156',
    Comments: 'Factura validada com sucesso pela AGT'
  })
} else if (validationResult.status === 'I') {
  // âŒ Factura INVÃLIDA!
  await updateSAP(sapDocEntry, {
    U_AGT_Status: 'Rejeitado AGT',
    U_AGT_ValidationStatus: 'I',
    Comments: validationResult.errors.join('; ')
  })
}
```

#### **5. Campos Customizados no SAP (UDF)**

O sistema usa **User Defined Fields** no SAP para armazenar dados AGT:

| Campo SAP | Tipo | DescriÃ§Ã£o |
|-----------|------|-----------|
| `U_AGT_DocNo` | String(60) | NÃºmero fiscal AGT (ex: FT 2025/156) |
| `U_AGT_RequestID` | String(50) | ID de referÃªncia AGT |
| `U_AGT_GUID` | String(50) | GUID da submissÃ£o |
| `U_AGT_Status` | String(50) | Status: "Enviado", "Validado", "Rejeitado" |
| `U_AGT_ValidationStatus` | String(1) | V=VÃ¡lida, I=InvÃ¡lida, P=Pendente |
| `U_AGT_ValidationDate` | DateTime | Data/hora da validaÃ§Ã£o |

### ğŸ”„ Fluxo Completo SAP â†” Sistema â†” AGT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. VENDA NO SAP                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  Operador cria factura FT-SAP-2025-001 no SAP                â”‚
â”‚  SAP calcula totais: 125.000 AOA + 17.500 IVA = 142.500 AOA â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (AutomÃ¡tico em <1 segundo)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. SAP â†’ SISTEMA                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ SAP envia via POST /api/sap/sync-invoice                  â”‚
â”‚  â€¢ Sistema valida dados com Zod                              â”‚
â”‚  â€¢ Gera nÃºmero AGT: FT 2025/156                              â”‚
â”‚  â€¢ Converte formato SAP â†’ AGT                                â”‚
â”‚  â€¢ Gera assinatura JWS RS256                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (2 segundos)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. SISTEMA â†’ AGT                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ POST para https://sigt.agt.minfin.gov.ao/.../registar... â”‚
â”‚  â€¢ AGT recebe e valida estrutura                             â”‚
â”‚  â€¢ AGT responde: { requestID: "AGT-20251001-0156" }          â”‚
â”‚  â€¢ Sistema atualiza SAP: "Enviado para validaÃ§Ã£o"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (15-60 segundos, assÃ­ncrono)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. VALIDAÃ‡ÃƒO AGT                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  AGT processa em background:                                 â”‚
â”‚    âœ… NIF do cliente existe?                                 â”‚
â”‚    âœ… SÃ©rie FT2025 registada?                                â”‚
â”‚    âœ… NÃºmero FT 2025/156 Ã© o prÃ³ximo vÃ¡lido?                 â”‚
â”‚    âœ… CÃ¡lculos corretos?                                     â”‚
â”‚    âœ… Assinatura vÃ¡lida?                                     â”‚
â”‚  RESULTADO: âœ… VÃLIDA                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (Polling a cada 15s)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. SISTEMA â† AGT                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ Sistema consulta via /obterEstado                         â”‚
â”‚  â€¢ AGT responde: { status: "V", documentNo: "FT 2025/156" }  â”‚
â”‚  â€¢ Sistema atualiza SAP: "Validado AGT"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (AutomÃ¡tico)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ATUALIZAÃ‡ÃƒO SAP                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  SAP Business One - Factura de Cliente                       â”‚
â”‚  DocNum: FT-SAP-2025-001                                     â”‚
â”‚  âœ… Status AGT: Validado                                     â”‚
â”‚  âœ… NÂº Fiscal AGT: FT 2025/156                               â”‚
â”‚  âœ… Status: V (VÃ¡lida)                                       â”‚
â”‚  âœ… Validado em: 2025-10-01 10:31:45                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (Sob demanda)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. GERAR PDF                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ Sistema gera PDF A4                                       â”‚
â”‚  â€¢ Inclui QR Code 350x350 com logo AGT                       â”‚
â”‚  â€¢ Mostra: FT 2025/156, totais, validaÃ§Ã£o AGT                â”‚
â”‚  â€¢ PDF pronto para imprimir e entregar ao cliente            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â±ï¸ TEMPO TOTAL**: ~1-2 minutos (tudo automÃ¡tico!)

### ğŸ› ï¸ Requisitos TÃ©cnicos SAP

Para integraÃ§Ã£o funcionar, o SAP precisa de:

1. **SAP Service Layer** ativo (para SAP Business One)
2. **User Defined Fields** criados nas tabelas:
   - `OINV` (A/R Invoice - Header)
   - `INV1` (A/R Invoice - Lines) [opcional]
3. **Webhook configurado** ou **Add-on instalado**
4. **Conectividade HTTPS** para chamar o sistema
5. **AutenticaÃ§Ã£o** via API Key

---

## 6ï¸âƒ£ BENEFÃCIOS DO SISTEMA

### ğŸ’° BenefÃ­cios Financeiros

| Sem Sistema | Com Sistema | Economia |
|-------------|-------------|----------|
| 30 min/factura (manual) | 2 min/factura (automÃ¡tico) | **93% mais rÃ¡pido** |
| 1 pessoa dedicada | AutomÃ¡tico | **Reduz custo de pessoal** |
| Erros frequentes â†’ multas | ValidaÃ§Ã£o automÃ¡tica | **Elimina multas** |
| Retrabalho com facturas rejeitadas | ValidaÃ§Ã£o prÃ©via | **Menos retrabalho** |

**Exemplo prÃ¡tico:**
- Empresa emite **100 facturas/dia**
- Sem sistema: 100 Ã— 30 min = **50 horas/dia** = **6,25 pessoas a tempo inteiro**
- Com sistema: 100 Ã— 2 min = **3,3 horas/dia** = **0,4 pessoas**
- **Economia: ~6 colaboradores ou AOA 5.000.000+/mÃªs** ğŸ’°

### âœ… BenefÃ­cios Operacionais

1. **AutomatizaÃ§Ã£o Completa**
   - âœ… Sem intervenÃ§Ã£o manual
   - âœ… Sem erros de digitaÃ§Ã£o
   - âœ… Processo standardizado

2. **Rastreabilidade Total**
   - âœ… HistÃ³rico de todas as facturas
   - âœ… Status de validaÃ§Ã£o em tempo real
   - âœ… Auditoria completa

3. **Conformidade Legal**
   - âœ… 100% conforme AGT
   - âœ… QR Code automÃ¡tico
   - âœ… Assinaturas digitais
   - âœ… Zero risco de multas

4. **IntegraÃ§Ã£o Perfeita**
   - âœ… SAP continua como antes
   - âœ… Utilizadores nÃ£o precisam mudar rotina
   - âœ… Sistema trabalha em background

### ğŸ”’ BenefÃ­cios de SeguranÃ§a

1. **Assinaturas CriptogrÃ¡ficas**
   - ğŸ” Facturas nÃ£o podem ser alteradas
   - ğŸ” Autenticidade garantida
   - ğŸ” Conformidade com padrÃµes internacionais

2. **ComunicaÃ§Ã£o Segura**
   - ğŸ” HTTPS (SSL/TLS)
   - ğŸ” Certificados digitais
   - ğŸ” Dados encriptados em trÃ¢nsito

3. **Auditoria Completa**
   - ğŸ“ Log de todas as operaÃ§Ãµes
   - ğŸ“ Timestamps em todos os eventos
   - ğŸ“ Rastreabilidade fim-a-fim

---

## 7ï¸âƒ£ COMO USAR NO DIA-A-DIA

### ğŸ‘¥ Para OPERADORES DE VENDAS

**O que muda para si?**
- âœ… **NADA!** Continua a usar o SAP normalmente
- âœ… Cria facturas como sempre fez
- âœ… Sistema trabalha automaticamente em background

**Ãšnica diferenÃ§a visÃ­vel:**
- Novos campos no SAP mostram status AGT:
  - "Status AGT: Validado âœ…"
  - "NÂº Fiscal: FT 2025/156"

**Se aparecer "Rejeitado AGT âŒ":**
1. Ver comentÃ¡rios (explica o erro)
2. Corrigir dados (ex: NIF errado)
3. Reenviar (automÃ¡tico)

### ğŸ“Š Para CONTABILISTAS

**Dashboard de Controlo:**
- Acesso a http://sistema.empresa.ao/dashboard
- Visualiza:
  - âœ… Facturas validadas hoje
  - â³ Facturas pendentes de validaÃ§Ã£o
  - âŒ Facturas rejeitadas (para corrigir)
  - ğŸ“Š EstatÃ­sticas mensais

**RelatÃ³rios DisponÃ­veis:**
1. Facturas por estado (V/I/P)
2. Tempo mÃ©dio de validaÃ§Ã£o
3. Taxa de aprovaÃ§Ã£o
4. Erros mais comuns

### ğŸ”§ Para EQUIPA DE TI

**MonitorizaÃ§Ã£o:**
- Dashboard tÃ©cnico em `/configuracoes`
- Logs de integraÃ§Ã£o
- Status de conectividade:
  - SAP â†” Sistema: âœ… OK
  - Sistema â†” AGT: âœ… OK

**Alertas AutomÃ¡ticos:**
- ğŸ“§ Email se AGT nÃ£o responder
- ğŸ“§ Email se taxa de erro > 5%
- ğŸ“§ Email se SAP desconectado

**Backup:**
- Todas as facturas em localStorage (navegador)
- CÃ³pia em base de dados SAP
- Pode consultar AGT a qualquer momento

### ğŸ“± Para CLIENTES (PÃºblico)

**VerificaÃ§Ã£o de Facturas:**
1. Cliente recebe factura com QR Code
2. Escaneia com telemÃ³vel
3. Abre portal AGT automaticamente
4. VÃª dados da factura
5. **Confirma que Ã© legÃ­tima** âœ…

**Portal do Contribuinte AGT:**
- URL: https://portaldocontribuinte.minfin.gov.ao
- Mostra:
  - NÃºmero da factura
  - Emissor (empresa)
  - Data
  - Valor total
  - Status: Validado âœ…

---

## 8ï¸âƒ£ PERGUNTAS FREQUENTES

### â“ Gerais

**P: O sistema substitui o SAP?**
R: âŒ NÃƒO! O sistema **complementa** o SAP. Continua a usar SAP normalmente, o sistema apenas envia as facturas para AGT automaticamente.

**P: Preciso de treino especial?**
R: âŒ NÃƒO para operadores! Se jÃ¡ usa SAP, nÃ£o muda nada. Apenas gestores/TI precisam conhecer o dashboard.

**P: E se a internet cair?**
R: O sistema **armazena localmente** e envia quando conexÃ£o voltar. NÃ£o perde dados!

**P: Quanto custa?**
R: Custos tÃ­picos:
- Desenvolvimento: AOA 5.000.000 - 10.000.000 (uma vez)
- ManutenÃ§Ã£o: AOA 500.000/mÃªs
- **ROI**: 2-3 meses (pela economia de pessoal)

### â“ TÃ©cnicas

**P: Funciona com qual versÃ£o do SAP?**
R: âœ… SAP Business One 9.3+
   âœ… SAP S/4HANA
   âœ… SAP ECC (com adaptaÃ§Ãµes)

**P: Precisa de servidor dedicado?**
R: OpÃ§Ãµes:
- â˜ï¸ Cloud (recomendado): Azure, AWS
- ğŸ–¥ï¸ On-premise: Servidor Windows/Linux
- ğŸ’» MÃ­nimo: 2GB RAM, 20GB disco

**P: Quais linguagens de programaÃ§Ã£o?**
R: 
- Frontend: **Next.js 14** (React + TypeScript)
- Backend: **Next.js API Routes** (Node.js)
- SAP Add-on: **C#** ou **VB.NET** (opcional)

**P: Ã‰ open-source?**
R: Depende do contrato. Pode ser:
- ProprietÃ¡rio (licenÃ§a da empresa)
- Open-source interno (empresa mantÃ©m)
- HÃ­brido (core open-source, customizaÃ§Ãµes proprietÃ¡rias)

### â“ Conformidade

**P: EstÃ¡ certificado pela AGT?**
R: Sistema cumpre 100% das especificaÃ§Ãµes tÃ©cnicas AGT. CertificaÃ§Ã£o oficial Ã© por empresa (nÃ£o por software).

**P: E se a AGT mudar as regras?**
R: Sistema Ã© **modular e atualizÃ¡vel**. MudanÃ§as podem ser implementadas rapidamente.

**P: Suporta todos os tipos de impostos?**
R: âœ… IVA (14% normal + isenÃ§Ãµes)
   âœ… IS (Imposto de Selo - 24 verbas)
   âœ… IEC (Imposto Especial de Consumo)
   âœ… Outros conforme tabelas AGT

**P: E facturas antigas (antes do sistema)?**
R: Sistema funciona **a partir da data de implementaÃ§Ã£o**. Facturas antigas continuam no SAP normalmente.

### â“ Suporte

**P: Quem suporta o sistema?**
R: 
- ğŸ”§ **TI Interna**: ConfiguraÃ§Ã£o bÃ¡sica
- ğŸ“ **Fornecedor**: Bugs e atualizaÃ§Ãµes
- ğŸ›ï¸ **AGT**: QuestÃµes fiscais/legais

**P: Tem documentaÃ§Ã£o?**
R: âœ… SIM! Este documento + mais:
- Manual TÃ©cnico (TI)
- Manual de Utilizador (Operadores)
- Guia de IntegraÃ§Ã£o SAP
- EspecificaÃ§Ã£o AGT (converted.md)

**P: Quem contactar em caso de erro?**
R:
1. Verificar dashboard (pode ser temporÃ¡rio)
2. Contactar TI interna
3. Se persistir: Fornecedor do sistema
4. Se rejeiÃ§Ã£o AGT: Contabilista resolve dados

---

## ğŸ¯ CONCLUSÃƒO

### ğŸ“Œ Resumo Executivo

Este **Sistema de FaturaÃ§Ã£o EletrÃ³nica AGT** Ã©:

âœ… **ObrigatÃ³rio por Lei** - Todas as empresas precisam cumprir AGT
âœ… **100% Conforme** - Cumpre todas as especificaÃ§Ãµes tÃ©cnicas
âœ… **Totalmente Integrado** - Liga SAP Ã  AGT automaticamente
âœ… **Transparente para Utilizadores** - SAP funciona como antes
âœ… **Seguro e AuditÃ¡vel** - Assinaturas digitais + rastreabilidade
âœ… **Economicamente ViÃ¡vel** - ROI em 2-3 meses

### ğŸš€ PrÃ³ximos Passos

1. **AprovaÃ§Ã£o de GestÃ£o** âœ…
2. **ConfiguraÃ§Ã£o TÃ©cnica** (TI + Fornecedor)
3. **Registo de SÃ©ries na AGT**
4. **Testes em Ambiente Sandbox**
5. **Treino de Utilizadores-Chave**
6. **Go-Live em ProduÃ§Ã£o**
7. **MonitorizaÃ§Ã£o ContÃ­nua**

### ğŸ“ Contactos

**Equipa do Projeto:**
- ğŸ‘¨â€ğŸ’¼ **Gestor de Projeto**: [Nome]
- ğŸ”§ **ResponsÃ¡vel TÃ©cnico**: [Nome]
- ğŸ“Š **Contabilidade**: [Nome]
- ğŸ–¥ï¸ **TI / SAP**: [Nome]

**Suporte TÃ©cnico:**
- ğŸ“§ Email: suporte@sistema.empresa.ao
- ğŸ“± Telefone: +244 XXX XXX XXX
- ğŸŒ Portal: https://sistema.empresa.ao

**AGT - AdministraÃ§Ã£o Geral TributÃ¡ria:**
- ğŸŒ Portal: https://portaldocontribuinte.minfin.gov.ao
- ğŸ“ Call Center: 222 XXXX XXX

---

## ğŸ“š ANEXOS

### A. GlossÃ¡rio de Termos

| Termo | Significado |
|-------|-------------|
| **AGT** | AdministraÃ§Ã£o Geral TributÃ¡ria de Angola |
| **API** | Interface de ProgramaÃ§Ã£o (como sistemas comunicam) |
| **ERP** | Enterprise Resource Planning (SAP Ã© um ERP) |
| **JWS** | JSON Web Signature (assinatura digital) |
| **NIF** | NÃºmero de IdentificaÃ§Ã£o Fiscal |
| **QR Code** | Quick Response Code (cÃ³digo de barras 2D) |
| **REST** | Representational State Transfer (tipo de API) |
| **SAP** | Systems, Applications, Products (software ERP alemÃ£o) |

### B. Tipos de Documentos Suportados

1. **FT** - Factura
2. **FR** - Factura/Recibo
3. **FA** - Factura de Adiantamento
4. **FG** - Factura Global
5. **AC** - Aviso de CobranÃ§a
6. **AR** - Aviso de CobranÃ§a/Recibo
7. **TV** - TalÃ£o de Venda
8. **RC** - Recibo Emitido
9. **RG** - Outros Recibos Emitidos
10. **RE** - Estorno ou Recibo de Estorno
11. **ND** - Nota de DÃ©bito
12. **NC** - Nota de CrÃ©dito
13. **AF** - Factura/Recibo de AutofacturaÃ§Ã£o
14. **RP** - PrÃ©mio ou Recibo de PrÃ©mio
15. **RA** - Resseguro Aceite
16. **CS** - ImputaÃ§Ã£o a Co-seguradoras
17. **LD** - ImputaÃ§Ã£o a Co-seguradora LÃ­der

### C. Estados de ValidaÃ§Ã£o AGT

| CÃ³digo | Nome | Significado | AÃ§Ã£o |
|--------|------|-------------|------|
| **P** | Pendente | Aguarda validaÃ§Ã£o AGT | Aguardar (15-60s) |
| **V** | VÃ¡lida | Aprovada pela AGT | âœ… OK, pode usar |
| **I** | InvÃ¡lida | Rejeitada pela AGT | âŒ Corrigir dados |
| **P** | Penalizada | VÃ¡lida mas atrasada (+24h) | âš ï¸ OK, mas multa |

### D. CÃ³digos de Erro Comuns

| CÃ³digo | DescriÃ§Ã£o | SoluÃ§Ã£o |
|--------|-----------|---------|
| **E01** | Campo obrigatÃ³rio ausente | Preencher campo faltante |
| **E23** | NIF do cliente invÃ¡lido | Verificar NIF no cadastro |
| **E94** | NIF diferente do registado | Verificar NIF da empresa |
| **E95** | Emissor diferente | Verificar dados da empresa |
| **E96** | Estrutura invÃ¡lida | Contactar suporte tÃ©cnico |
| **E97** | Timeout AGT | Tentar novamente |
| **E98** | Muitas solicitaÃ§Ãµes | Aguardar 1-2 minutos |

---

## âœ… LISTA DE VERIFICAÃ‡ÃƒO (Checklist)

### Para GestÃ£o:
- [ ] Ler e compreender este documento
- [ ] Aprovar investimento no sistema
- [ ] Designar responsÃ¡vel do projeto
- [ ] Aprovar timeline de implementaÃ§Ã£o

### Para TI:
- [ ] Verificar conectividade SAP â†” Sistema
- [ ] Configurar User Defined Fields no SAP
- [ ] Configurar webhook ou add-on SAP
- [ ] Testar envio de factura de teste
- [ ] Monitorizar logs e alertas

### Para Contabilidade:
- [ ] Registar sÃ©ries de numeraÃ§Ã£o na AGT
- [ ] Validar cÃ¡lculos de impostos
- [ ] Configurar cÃ³digos CAE
- [ ] Treinar equipa nos novos processos
- [ ] Acompanhar dashboard de facturas

### Para Utilizadores:
- [ ] Conhecer novos campos no SAP
- [ ] Saber identificar status AGT
- [ ] Saber como reagir a facturas rejeitadas
- [ ] Contactos de suporte memorizados

---

**ğŸ“… Data de CriaÃ§Ã£o**: 12 Novembro 2025  
**ğŸ“ VersÃ£o**: 1.0  
**âœï¸ Autor**: Equipa TÃ©cnica Sistema Factura AGT  
**ğŸ”„ Ãšltima AtualizaÃ§Ã£o**: 12 Novembro 2025

---

**ğŸ‰ SISTEMA PRONTO PARA PRODUÃ‡ÃƒO!**

Este sistema garante **conformidade 100% com AGT** e **integraÃ§Ã£o perfeita com SAP**, automatizando todo o processo de faturaÃ§Ã£o eletrÃ³nica e eliminando erros manuais.

**Bem-vindo Ã  nova era da faturaÃ§Ã£o eletrÃ³nica em Angola!** ğŸ‡¦ğŸ‡´
